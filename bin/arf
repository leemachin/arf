#!/usr/bin/env ruby

lib = File.expand_path(File.dirname(__FILE__) + '/../lib')
$LOAD_PATH.unshift(lib) if File.directory?(lib) && !$LOAD_PATH.include?(lib)

require 'optparse'
require 'ostruct'
require 'pathname'
require 'arf'


unless Process.euid.zero?
  puts "Sorry, the LED Board requires root privileges to run. Try again with sudo."
  exit!
end

arf = Arf.new

OptionParser.new do |opts|
  opts.banner = "Usage: sudo arf [options]"

  opts.on('-d', '--[no-]daemonize', 'Run this shit in the background') do |daemonize|
    arf.daemon = daemonize
  end

  opts.on('-p', '--pidfile PIDFILE', 'File to write the PID to when run as a daemon') do |pidfile|
    arf.pidfile = Pathname.new(pidfile)
  end

  opts.on('-l', '--logfile LOGFILE', 'File to write logs to when run as a daemon') do |logfile|
    arf.logfile = Pathname.new(logfile)
  end

  opts.on('-t', '--token TOKEN', 'Access token for Travis CI Pro') do |token|
    arf.access_token = token
  end

  opts.on('-o', '--org ORG', 'Github organisation to search for private repos in') do |org|
    arf.travis_org = org
  end
end.parse!

arf.start!

at_exit do
  arf.stop!
end
